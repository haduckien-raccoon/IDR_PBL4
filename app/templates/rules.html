<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manage Rules - IDR_Project</title>

  <!-- CSS chung của dashboard -->
  <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    body.rules-page .main-content {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 20px;
    }

    .rules-grid {
      display: grid;
      grid-template-columns: 1.1fr 2fr 1fr;
      gap: 20px;
    }

    .widget {
      background: #15182b;
      border-radius: 12px;
      box-shadow: 0 0 0 1px rgba(255,255,255,0.03);
      padding: 18px 20px;
    }

    .widget-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .widget-header h4 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: #f5f7ff;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .widget-header i {
      margin-right: 8px;
      color: #4dabf7;
    }

    .rule-form-row {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px 14px;
      margin-bottom: 10px;
    }

    .rule-form-row.single {
      grid-template-columns: 1fr;
    }

    .rule-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .rule-field label {
      font-size: 12px;
      color: #b5bfd6;
      font-weight: 500;
    }

    .rule-field input,
    .rule-field select,
    .rule-field textarea {
      background: #0f1220;
      border-radius: 7px;
      border: 1px solid #272b3f;
      padding: 7px 9px;
      color: #e4e7ff;
      font-size: 13px;
      outline: none;
    }

    .rule-field input::placeholder,
    .rule-field textarea::placeholder {
      color: #6f7590;
    }

    .rule-textarea {
      min-height: 90px;
      resize: vertical;
      font-family: monospace;
      line-height: 1.35;
    }

    .rule-add-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 12px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .rule-add-footer .hint {
      font-size: 11px;
      color: #8b91ad;
    }

    .stat-cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    .stat-card {
      background: #111424;
      border-radius: 10px;
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-card span {
      font-size: 11px;
      color: #8f96b6;
    }

    .stat-card strong {
      font-size: 18px;
      color: #f5f7ff;
    }

    .stat-card.low     strong { color: #4caf50; }
    .stat-card.medium  strong { color: #ffc107; }
    .stat-card.high    strong { color: #ff7043; }
    .stat-card.critical strong { color: #ff5252; }

    .ids-rules-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .ids-rules-header h4 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
      color: #f5f7ff;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .ids-rules-header i {
      margin-right: 8px;
      color: #4dabf7;
    }

    .rule-search input {
      min-width: 220px;
      background: #0f1220;
      border-radius: 20px;
      border: 1px solid #272b3f;
      padding: 6px 12px;
      color: #e4e7ff;
      font-size: 13px;
      outline: none;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .table thead {
      background: #151932;
    }

    .table thead th {
      padding: 8px 8px;
      text-align: left;
      color: #a5acc8;
      font-weight: 500;
      border-bottom: 1px solid #24283b;
      white-space: nowrap;
    }

    .table tbody td {
      padding: 7px 8px;
      border-bottom: 1px solid #1b1f33;
      color: #e4e7ff;
      vertical-align: top;
    }

    .badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .badge-low {
      background: rgba(76,175,80,0.1);
      color: #81c784;
    }
    .badge-medium {
      background: rgba(255,193,7,0.1);
      color: #ffd54f;
    }
    .badge-high {
      background: rgba(255,112,67,0.1);
      color: #ffab91;
    }
    .badge-critical {
      background: rgba(244,67,54,0.1);
      color: #ef9a9a;
    }
    .badge-unknown {
      background: rgba(144,164,174,0.15);
      color: #cfd8dc;
    }

    .btn-xs {
      border: none;
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 11px;
      cursor: pointer;
      margin-left: 4px;
    }

    .btn-edit {
      background: #26c6da;
      color: #081018;
    }

    .btn-delete {
      background: #ef5350;
      color: #fff;
    }

    .btn {
      border-radius: 8px;
      border: none;
      cursor: pointer;
      padding: 7px 16px;
      font-size: 13px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn.btn-secondary {
      background: #1e2236;
      color: #e4e7ff;
    }

    .btn.btn-danger {
      background: #f7576b;
      color: #fff;
    }

    .status-pill {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      background: rgba(76, 175, 80, 0.14);
      color: #a5d6a7;
    }

    @media (max-width: 1200px) {
      .rules-grid {
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.8fr);
        grid-template-rows: auto auto;
      }
      .rules-grid > .widget:last-child {
        grid-column: 1 / span 2;
      }
    }

    @media (max-width: 900px) {
      .rules-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body class="rules-page">
  <div class="dashboard-container">

    {% include 'includes/sidebar.html' %}

    <!-- Main -->
    <main class="main-content">
      <!-- Header -->
      <!-- <div class="page-header">
        <div>
          <h2>IDS RULES MANAGER</h2>
          <p>Manage detection rules for your Intrusion Detection & Response system.</p>
        </div>
        <div>
          <span class="status-pill">
            <i class="fa-solid fa-circle-check"></i> SYSTEM STATUS: ONLINE
          </span>
        </div>
      </div> -->
      <header class="header">
        <div class="system-status">
          RULES MANAGER • SYSTEM STATUS:
          <span class="status-online">ONLINE</span>
        </div>
        <div class="user-menu">
          <i class="fa-solid fa-bell"></i>
          <i class="fa-solid fa-moon"></i>
          <i class="fa-solid fa-user-circle"></i>
        </div>
      </header>

      <!-- Top row: Filters + Add Rule + Stats -->
      <div class="rules-grid">

        <!-- Rule Filters -->
        <div class="widget">
          <div class="widget-header">
            <h4><i class="fa-solid fa-filter"></i> Rule Filters</h4>
          </div>

          <div class="rule-form-row single">
            <div class="rule-field">
              <label>Severity</label>
              <select id="rule-severity-filter">
                <option value="">All</option>
                <option value="critical">critical</option>
                <option value="high">high</option>
                <option value="medium">medium</option>
                <option value="low">low</option>
              </select>
            </div>
          </div>

          <div class="rule-form-row single">
            <div class="rule-field">
              <label>Protocol</label>
              <select id="rule-proto-filter">
                <option value="">Any</option>
                <option value="tcp">TCP</option>
                <option value="udp">UDP</option>
                <option value="http">HTTP</option>
              </select>
            </div>
          </div>

          <div class="rule-form-row single">
            <div class="rule-field">
              <label>Group Name</label>
              <select id="rule-groupname"></select>
            </div>
          </div>

          <button class="btn btn-secondary" id="apply-filter-btn" style="margin-top:10px;width:100%;">
            <i class="fa-solid fa-magnifying-glass"></i> Apply Filter
          </button>
        </div>

        <!-- Add Rule -->
        <div class="widget">
          <div class="widget-header">
            <h4 id="form-header-title"><i class="fa-solid fa-plus-circle"></i> Add Rule</h4>
          </div>

          <div class="rule-form-row single">
            <div class="rule-field">
              <label>Message</label>
              <input type="text" id="rule-message" placeholder="Example: Possible SQL injection attempt detected">
            </div>
          </div>

          <div class="rule-form-row">
            <div class="rule-field">
              <label>Severity</label>
              <select id="rule-severity">
                <option>critical</option>
                <option>high</option>
                <option selected>medium</option>
                <option>low</option>
              </select>
            </div>
            <div class="rule-field">
              <label>Group Name</label>
              <select id="rule-groupname-add"></select>
            </div>
            <div class="rule-field">
              <label>Action</label>
              <select id="rule-action">
                <option>alert</option>
                <option>drop</option>
                <option>log</option>
                <option>block</option>
              </select>
            </div>
          </div>

          <div class="rule-form-row">
            <div class="rule-field">
              <label>Protocol</label>
              <input type="text" id="rule-proto" placeholder="TCP / UDP / HTTP">
            </div>
            <div class="rule-field">
              <label>Destination Port</label>
              <input type="number" id="rule-dport" placeholder="80">
            </div>
            <div class="rule-field">
              <label>Fast Pattern</label>
              <input type="text" id="rule-fast-pattern" placeholder="e.g. alter">
            </div>
          </div>
          
          <div class="rule-form-row">
            <div class="rule-field">
              <label>Field (comma separated)</label>
              <input type="text" id="rule-field" placeholder="http_uri, http_client_body">
            </div>
            <div class="rule-field">
              <label>Flow (comma separated)</label>
              <input type="text" id="rule-flow" placeholder="to_server, established">
            </div>
            <div class="rule-field">
              <label>Content (comma separated)</label>
              <input type="text" id="rule-content" placeholder="alter, select">
            </div>
          </div>

          <div class="rule-form-row single">
            <div class="rule-field">
              <label>Regex pattern (PCRE)</label>
              <textarea id="rule-pattern" class="rule-textarea" placeholder="Regex pattern (PCRE)..."></textarea>
            </div>
          </div>

          <div class="rule-add-footer">
            <div class="hint">
              Hint: You can copy a regex from <code>rules.json</code> or create your own.
            </div>
            
            <div style="display:flex; gap:10px;">
              <button id="cancel-edit-btn" class="btn btn-secondary" style="display:none;">
                <i class="fa-solid fa-xmark"></i> Cancel
              </button>
              
              <button id="add-rule-btn" class="btn btn-danger" style="min-width:180px;">
                <i class="fa-solid fa-plus"></i> Add Rule
              </button>
            </div>
          </div>
        </div>

        <!-- Quick Statistics -->
        <div class="widget">
          <div class="widget-header">
            <h4><i class="fa-solid fa-gauge"></i> Quick Statistics</h4>
          </div>
          <div class="stat-cards">
            <div class="stat-card">
              <span>Total Rules</span>
              <strong id="rule-total">0</strong>
            </div>
            <div class="stat-card low">
              <span>Low Severity</span>
              <strong id="rule-low-stat">0</strong>
            </div>
            <div class="stat-card medium">
              <span>Medium Severity</span>
              <strong id="rule-medium-stat">0</strong>
            </div>
            <div class="stat-card high">
              <span>High Severity</span>
              <strong id="rule-high-stat">0</strong>
            </div>
            <div class="stat-card critical">
              <span>Critical Severity</span>
              <strong id="rule-critical">0</strong>
            </div>
          </div>
        </div>
      </div>

      <!-- IDS Rules List -->
      <div class="widget">
        <div class="ids-rules-header">
          <div>
            <h4><i class="fa-solid fa-database"></i> IDS Rules List</h4>
          </div>
          <div class="rule-search">
            <input type="text" id="rule-search" placeholder="Search...">
          </div>
        </div>

        <div style="overflow-x:auto;">
          <table class="table" id="rules-table">
            <thead>
              <tr>
                <th>UUID</th>
                <th>Group Name</th>
                <th>Message</th>
                <th>Severity</th>
                <th>Proto</th>
                <th>Dst Port</th>
                <th>Pattern Regex (Pcre)</th>
                <th>Fast Pattern</th>
                <th>Field</th>
                <th>Flow</th>
                <th>Content</th>
                <th>Action</th>
                <th style="text-align:right;">Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- JS sẽ fill -->
            </tbody>
          </table>
        </div>
      </div>

    </main>
  </div>

  <script src="{{ url_for('static', path='js/rules.js') }}"></script>
</body>
</html>
