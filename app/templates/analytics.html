<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Analytics & Reports - IDR_Project</title>

  <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* CSS riêng cho Heatmap */
    .heatmap-grid {
      display: grid;
      grid-template-columns: 30px repeat(24, 1fr); /* Cột giờ */
      grid-template-rows: 20px repeat(7, 1fr);    /* Hàng thứ */
      gap: 2px;
      margin-top: 10px;
      font-size: 10px;
      color: #888;
    }
    .hm-cell {
      background: #2a2a45;
      border-radius: 2px;
      transition: all 0.2s;
    }
    .hm-cell:hover { border: 1px solid #fff; }
    .hm-label-x { text-align: center; line-height: 20px; }
    .hm-label-y { text-align: right; padding-right: 5px; line-height: 20px; }
    
    /* Màu heatmap theo mức độ */
    .hm-l1 { background: #1a3a4a; }
    .hm-l2 { background: #2a5a6a; }
    .hm-l3 { background: #30e3ca; }
    .hm-l4 { background: #f0a050; }
    .hm-l5 { background: #e94560; }
  </style>
</head>
<body>
  <div class="dashboard-container">

    {% include 'includes/sidebar.html' %}

    <main class="main-content">
      <header class="header">
        <div class="system-status">
          ANALYTICS & REPORTS • <span id="status-period" class="status-online">LAST 30 DAYS</span>
        </div>
        <div class="user-menu">
            <i class="fa-solid fa-bell"></i>
            <i class="fa-solid fa-moon"></i>
            <i class="fa-solid fa-user-circle"></i>
        </div>
      </header>

      <aside class="left-column">
        <div class="widget">
          <div class="widget-header">
            <h4><i class="fa-solid fa-calendar-alt"></i> Time Range</h4>
          </div>
          <div class="filter-row">
            <div>
              <label>Mode</label>
              <select id="range-mode">
                <option value="7d">Last 7 Days</option>
                <option value="30d" selected>Last 30 Days</option>
                <option value="90d">Last 90 Days</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
          </div>
          <div class="filter-row" id="custom-date-row" style="display:none; margin-top:10px;">
            <div style="width:100%">
              <label>From</label>
              <input type="date" id="range-from" style="width:100%; margin-bottom:5px;">
              <label>To</label>
              <input type="date" id="range-to" style="width:100%;">
            </div>
          </div>
          <button id="btn-update-stats" class="btn btn-secondary" style="margin-top:15px;width:100%;">
            <i class="fa-solid fa-rotate"></i> Update Report
          </button>
        </div>

        <div class="widget">
          <div class="widget-header">
            <h4><i class="fa-solid fa-bug"></i> Severity Dist.</h4>
          </div>
          <div class="chart-container" style="height: 250px;">
            <canvas id="severityChart"></canvas>
          </div>
        </div>
      </aside>

      <section class="main-column">
        <div class="widget">
          <div class="widget-header">
            <h4><i class="fa-solid fa-chart-area"></i> Attack Traffic Trend</h4>
          </div>
          <div class="chart-container" style="height: 220px;">
            <canvas id="trendChart"></canvas>
          </div>
        </div>
        <div class="widget">
            <div class="widget-header">
              <h4><i class="fa-solid fa-fire-flame-curved"></i> Attack Heatmap (Day vs Hour)</h4>
            </div>
            <div id="heatmap-container" class="heatmap-grid">
               </div>
        </div>
      </section>

      <aside class="right-column">
        <div class="widget">
            <div class="widget-header">
              <h4><i class="fa-solid fa-globe"></i> Top Targets/IPs</h4>
            </div>
            <canvas id="countryChart" height="200"></canvas>
        </div>

        <div class="widget">
          <div class="widget-header">
            <h4><i class="fa-solid fa-file-export"></i> Export Data</h4>
          </div>
          <p style="font-size:0.85rem;color:var(--text-secondary);">
            Download current report view for stakeholders.
          </p>
          <button class="btn btn-secondary" style="width:100%;margin-top:8px;" onclick="alert('Feature coming soon: Export PDF')">
            <i class="fa-solid fa-file-pdf"></i> Export PDF
          </button>
          <button class="btn btn-secondary" style="width:100%;margin-top:6px;" onclick="alert('Feature coming soon: Export CSV')">
            <i class="fa-solid fa-file-csv"></i> Export CSV
          </button>
        </div>
      </aside>
    </main>
  </div>
  
  <script>
    window.__CONFIG__ = {
      API_BASE: "{{ api_base if api_base is defined else '' }}"
    };
  </script>
  <script src="{{ url_for('static', path='js/analytics.js') }}"></script>
</body>
</html>