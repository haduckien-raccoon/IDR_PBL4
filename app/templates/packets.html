<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Realtime Traffic Monitor</title>
  <style>
    body {
      font-family: monospace;
      background: #0d1117;
      color: #e6edf3;
      margin: 0;
      padding: 0;
    }
    header {
      background: #161b22;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    h1 {
      color: #58a6ff;
      margin: 0;
      font-size: 1.4em;
    }
    .container {
      padding: 15px 20px;
    }
    input {
      width: 350px;
      padding: 6px;
      border: none;
      border-radius: 4px;
      background: #21262d;
      color: #e6edf3;
      margin-bottom: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #30363d;
      padding: 5px;
      vertical-align: top;
    }
    th {
      background: #161b22;
      color: #58a6ff;
    }
    tr:nth-child(even) {
      background: #161b22;
    }
    pre {
      white-space: pre-wrap;
      color: #aaa;
      margin: 0;
    }
  </style>
  <script>
    let logs = [];
    let ws;

    function renderTable() {
      const query = document.getElementById("search").value.toLowerCase();
      const tbody = document.getElementById("packetTable");
      tbody.innerHTML = "";

      for (const item of logs) {
        if (query && !JSON.stringify(item).toLowerCase().includes(query)) continue;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.timestamp || ""}</td>
          <td>${item.level || ""}</td>
          <td>${item.proto || ""}</td>
          <td>${item.src || ""}</td>
          <td>${item.dst || ""}</td>
          <td>${item.entropy || ""}</td>
          <td>${item.bytes || ""}</td>
          <td><pre>${item.body || ""}</pre></td>
        `;
        tbody.appendChild(tr);
      }
    }

    function initWebSocket() {
      let ws = new WebSocket("ws://localhost:8000/api/logs/ws/traffic");
      ws.onmessage = ev => {
        const data = JSON.parse(ev.data);
        logs.unshift(data); // log má»›i lÃªn Ä‘áº§u
        if (logs.length > 1000) logs.pop(); // giá»¯ tá»‘i Ä‘a 1000
        renderTable();
      };
      ws.onclose = () => setTimeout(initWebSocket, 2000);
    }

    window.onload = () => {
      initWebSocket();
      document.getElementById("search").addEventListener("input", renderTable);
    };
  </script>
</head>
<body>
  <header>
    <h1>Realtime Traffic Monitor</h1>
    <a href="/api/logs/alerts" style="color: #ff6b6b;">View Alerts</a>
  </header>
  <div class="container">
    <input id="search" placeholder="ðŸ” Filter logs..." />
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Level</th>
          <th>Proto</th>
          <th>Source</th>
          <th>Destination</th>
          <th>Entropy</th>
          <th>Bytes</th>
          <th>Body</th>
        </tr>
      </thead>
      <tbody id="packetTable"></tbody>
    </table>
  </div>
</body>
</html>
 